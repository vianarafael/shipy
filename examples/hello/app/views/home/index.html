<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shipy â€¢ Hello</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link rel="stylesheet" href="/public/base.css" />
  </head>
  <body>
    <main class="container">
      <h1>ðŸ‘‹ Hello from Shipy</h1>
      <p>
        This page is rendered with Jinja2. It also demonstrates a cookie
        session.
      </p>
      <p><strong>Visits this session:</strong> {{ visits }}</p>
      <p>
        Try refreshing! Edit <code>app/views/home/index.html</code> to change
        this page.
      </p>
    </main>

    <div>
      {% if user %}
      <p>Welcome back, {{ user.email }}!</p>
      {% else %}
      <p>
        Welcome! Please <a href="/signup">sign up</a> or
        <a href="/login">log in</a>.
      </p>
      {% endif %}
    </div>
    {% if flashes %}
    <div class="stack">
      {% for f in flashes %}
      <div class="flash {{ f.kind }}">{{ f.msg }}</div>
      {% endfor %}
    </div>
    {% endif %} {% if user %}
    <div style="margin-top: 20px">
      <a href="/secret" class="btn">Secret Page</a>
      <form
        method="post"
        action="/logout"
        style="display: inline; margin-left: 10px"
      >
        <input type="hidden" name="csrf" value="{{ csrf }}" />
        <button class="btn">Logout</button>
      </form>
    </div>

    <!-- HTMX Todo List -->
    <div class="card" style="margin-top: 20px">
      <h3>My Todos</h3>

      <!-- Todo Form -->
      <form
        hx-post="/todos"
        hx-target="#todo-list"
        hx-swap="innerHTML"
        class="stack"
      >
        <input type="hidden" name="csrf" value="{{ csrf }}" />
        <div style="display: flex; gap: 10px">
          <input
            class="input"
            name="title"
            placeholder="New todo..."
            style="flex: 1"
          />
          <button class="btn" type="submit">Add</button>
        </div>
      </form>

      <!-- Todo List -->
      <div id="todo-list">{% include "todos/list.html" %}</div>
    </div>
    {% endif %}
  </body>
</html>
